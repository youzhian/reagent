<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="include::head('欢迎使用试剂管理系统')">
    <meta charset="UTF-8"/>
    <!-- import CSS -->
    <link rel="stylesheet" href="css/element-2.15.6.css">
    <!-- import Vue before Element -->
    <script src="js/vue.js"></script>
    <!-- import JavaScript -->
    <script src="js/element-2.15.6.js"></script>
    <title>欢迎来到首页</title>
</head>
<body>
<div id="app">
    <el-container>
        <el-header style="border-bottom:2px solid #d4dde4;">
            <template>
                <el-row>
                    <el-col :span="6">
                        <div class="grid-content bg-purple">
                            <img th:src="@{/image/logo.jpg}" height="50px">
                        </div>
                    </el-col>
                    <el-col :span="10"><div class="grid-content bg-purple-light" style="text-align: center;"><h3>试剂库存信息管理系统</h3></div></el-col>
                </el-row>
            </template>
        </el-header>
        <el-container>
            <el-aside  width="210px" style="height: 100%;min-height: 500px;border-right:2px solid #d4dde4;" >
                <el-menu  class="el-menu-vertical-demo" @open="handleOpen" @close="handleClose" :collapse="isCollapse" v-for="(m,i) in menu">
                    <el-submenu  v-if="m.childs != null" :index="m.id">
                        <template slot="title">
                            <i v-if="m.icon" :class="m.icon"></i>
                            <span slot="title">{{m.name}}</span>
                        </template>
                        <el-menu-item v-for="(mm,im) in m.childs" :index="mm.id" :data="mm" @click="addTab(mm)">
                            <i v-if="mm.icon" :class="mm.icon"></i>
                            <span slot="title">{{mm.name}}</span>
                        </el-menu-item>
                    </el-submenu>
                    <el-menu-item v-else :index="m.id" @click="addTab(m)" :data="m">
                        <i v-if="m.icon" :class="m.icon"></i>
                        <span slot="title">{{m.name}}</span>
                    </el-menu-item>
                </el-menu>
            </el-aside>
            <el-main>
                <el-tabs ref="mainTabs" v-model="editableTabsValue" type="card" @tab-remove="removeTab">
                    <el-tab-pane
                            v-for="(item, index) in editableTabs"
                            :key="item.name"
                            :label="item.title"
                            :name="item.name"
                            :closable="item.closable">
                        <iframe v-if="item.url" :src="item.url" style="width: 100%;height: 100%;min-height: 800px" frameborder="0"></iframe>
                    </el-tab-pane>
                </el-tabs>
            </el-main>
        </el-container>
    </el-container>
</div>
</body>
<style>
    .grid-content {
        border-radius: 4px;
        min-height: 36px;
    }
</style>
<script th:inline="javascript">

    var path= /*[[@{/}]]*/ "/";
    new Vue({
        el: '#app',
        data: function() {
            return {
                visible: false,
                isCollapse: false,
                editableTabsValue: 'home',
                editableTabs: [{
                    title: "主页",
                    name: "home",
                    url: path+"home",
                    closable: false
                }],
                openedTabs:["home"],
                tabIndex: 1,
                menu: [[${menus}]]||{}
            }
        },
        created(){

        },
        methods:{

            handleOpen(key, keyPath) {
            },
            handleClose(key, keyPath) {
            },
            addTab(data) {
                let tabName = data.id+"_"+data.menuKey;
                let old = this.openedTabs[tabName];
                if(!old){
                    this.editableTabs.push({
                        title: data.name,
                        name: tabName,
                        content: path+data.url,
                        url: path+data.url,
                        closable: true
                    });
                    this.openedTabs[tabName]=1;
                }
                this.editableTabsValue = tabName;
            },
            removeTab(targetName) {
                let tabs = this.editableTabs;
                let activeName = this.editableTabsValue;
                if (activeName === targetName) {
                    tabs.forEach((tab, index) => {
                        if (tab.name === targetName) {
                            let nextTab = tabs[index + 1] || tabs[index - 1];
                            if (nextTab) {
                                activeName = nextTab.name;
                            }
                        }
                    });
                }

                this.editableTabsValue = activeName;
                this.editableTabs = tabs.filter(tab => tab.name !== targetName);
                delete this.openedTabs[targetName];
            }
        }
    })
</script>
</html>